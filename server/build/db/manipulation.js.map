{"version":3,"sources":["../../src/db/manipulation.js"],"names":["saveMessageToChannel","text","userName","channel","createChannelIfNotExists","chan","user","DB","insertIntoCollection","body","author","_key","channelKey","addUser","username","console","log","name","undefined"],"mappings":";;;;;;;;AAAA;;AACA;;AAQA;;;;;;;;SAEsBA,oB;;;;;;;0BAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAsCC,YAAAA,IAAtC,QAAsCA,IAAtC,EAA4CC,QAA5C,QAA4CA,QAA5C,EAAsDC,OAAtD,QAAsDA,OAAtD;AAAA;AAAA,mBACcC,wBAAwB,CAACD,OAAD,CADtC;;AAAA;AACCE,YAAAA,IADD;AAAA;AAAA,mBAEc,4BAAcH,QAAd,CAFd;;AAAA;AAECI,YAAAA,IAFD;AAAA,6CAIEC,eAAGC,oBAAH,CAAwB,OAAxB,EAAiC;AAAEC,cAAAA,IAAI,EAAER,IAAR;AAAcS,cAAAA,MAAM,EAAEJ,IAAI,CAACK,IAA3B;AAAiCC,cAAAA,UAAU,EAAEP,IAAI,CAACM;AAAlD,aAAjC,CAJF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAOeE,O;;;;;;;0BAAf,kBAAuBC,QAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACK,CAAC,sBAAQA,QAAR,CADN;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEHC,YAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BF,QAA3B;AAFG,8CAGIP,eAAGC,oBAAH,CAAwB,OAAxB,EAAiC;AAAEM,cAAAA,QAAQ,EAARA;AAAF,aAAjC,CAHJ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAOQV,wB;;;;;;;0BAAf,kBAAwCa,IAAxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACwB,+BAAiBA,IAAjB,CADxB;;AAAA;AACQd,YAAAA,OADR;;AAAA,kBAEMA,OAAO,KAAKe,SAFlB;AAAA;AAAA;AAAA;;AAAA,8CAGWX,eAAGC,oBAAH,CAAwB,UAAxB,EAAoC;AAAES,cAAAA,IAAI,EAAJA;AAAF,aAApC,CAHX;;AAAA;AAAA,8CAKSd,OALT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","sourcesContent":["import DB from './index';\nimport {\n  getNodesByChannel,\n  getMessagesByUsername,\n  getUserByName,\n  hasUser,\n  hasChannel,\n  getChannelByName,\n} from './queries';\nimport { log } from '../utils/logger';\n\nexport async function saveMessageToChannel({ text, userName, channel }) {\n  const chan = await createChannelIfNotExists(channel);\n  const user = await getUserByName(userName);\n\n  return DB.insertIntoCollection('posts', { body: text, author: user._key, channelKey: chan._key });\n}\n\nexport async function addUser(username) {\n  if (await !hasUser(username)) {\n    console.log('adding user', username);\n    return DB.insertIntoCollection('users', { username });\n  }\n}\n\nasync function createChannelIfNotExists(name) {\n  const channel = await getChannelByName(name);\n  if (channel === undefined) {\n    return DB.insertIntoCollection('channels', { name });\n  }\n  return channel;\n}\n"],"file":"manipulation.js"}